<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTXOracle - Whale Detection Dashboard</title>
    <link rel="stylesheet" href="/static/css/whale_dashboard.css">
</head>
<body>
    <!-- Connection Status Indicator -->
    <div class="status-bar" id="status-bar">
        <span class="status-indicator disconnected" id="connection-status">
            <span class="status-dot"></span>
            <span class="status-text">Connecting...</span>
        </span>
        <span class="last-update" id="last-update">No data yet</span>
        <button class="audio-toggle muted" id="audio-toggle" title="Enable sound notifications for large transactions">
            <span class="audio-icon">üîá</span>
        </button>
        <button class="alert-settings-toggle" id="alert-settings-toggle" title="Alert settings">
            <span class="alert-icon">üîî</span>
        </button>
    </div>

    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">
                <span class="whale-icon">üêã</span>
                Whale Detection Dashboard
            </h1>
            <div class="header-subtitle">
                Real-time Bitcoin whale transaction monitoring (>100 BTC)
            </div>
        </div>
    </header>

    <!-- Main Dashboard Content -->
    <main class="dashboard-main">

        <!-- Net Flow Section (Primary Focus) -->
        <section class="net-flow-section">
            <div class="section-header">
                <h2>Current Whale Net Flow</h2>
                <div class="info-tooltip" title="Buy pressure minus sell pressure over 5-minute intervals">
                    <span class="tooltip-icon">‚ìò</span>
                </div>
            </div>

            <div class="net-flow-display" id="net-flow-display">
                <div class="loading-state" id="net-flow-loading">
                    <div class="spinner"></div>
                    <p>Loading whale flow data...</p>
                </div>

                <div class="net-flow-content hidden" id="net-flow-content">
                    <!-- BTC Value -->
                    <div class="net-flow-value">
                        <span class="value-label">Net Flow</span>
                        <div class="value-btc" id="value-btc">0.00 BTC</div>
                        <div class="value-usd" id="value-usd">$0 USD</div>
                    </div>

                    <!-- Direction Indicator -->
                    <div class="direction-indicator" id="direction-indicator">
                        <div class="direction-arrow" id="direction-arrow">
                            <span class="arrow-symbol">‚Üí</span>
                        </div>
                        <div class="direction-label" id="direction-label">NEUTRAL</div>
                        <div class="direction-description" id="direction-description">
                            No significant whale activity
                        </div>
                    </div>
                </div>

                <div class="error-state hidden" id="net-flow-error">
                    <p class="error-message">‚ö†Ô∏è Unable to load data</p>
                    <button class="retry-button" id="retry-button">Retry</button>
                </div>
            </div>
        </section>

        <!-- Transaction Feed Section -->
        <section class="transaction-feed-section">
            <div class="section-header">
                <h2>Recent Whale Transactions</h2>
                <div class="feed-controls">
                    <button class="control-button" id="toggle-filters" title="Show/hide filters">
                        <span class="control-icon">üîç</span>
                        <span class="control-label">Filters</span>
                    </button>
                    <button class="control-button" id="filter-high-urgency" title="Show only high urgency (‚â•80)">
                        <span class="control-icon">üî•</span>
                        <span class="control-label">High Urgency</span>
                    </button>
                    <button class="control-button" id="pause-feed" title="Pause auto-scroll">
                        <span class="control-icon">‚è∏</span>
                        <span class="control-label">Pause</span>
                    </button>
                    <button class="control-button" id="clear-feed" title="Clear transaction feed">
                        <span class="control-icon">üóë</span>
                        <span class="control-label">Clear</span>
                    </button>
                </div>
            </div>

            <!-- Filter Panel -->
            <div class="filter-panel hidden" id="filter-panel">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Min Amount (BTC)</label>
                        <input
                            type="number"
                            id="filter-min-amount"
                            class="filter-input"
                            placeholder="0"
                            min="0"
                            step="10"
                        />
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Direction</label>
                        <div class="filter-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-buy" checked />
                                <span>‚Üë BUY</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-sell" checked />
                                <span>‚Üì SELL</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-neutral" checked />
                                <span>‚Üí NEUTRAL</span>
                            </label>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Min Urgency</label>
                        <input
                            type="range"
                            id="filter-urgency"
                            class="filter-slider"
                            min="0"
                            max="100"
                            value="0"
                            step="10"
                        />
                        <span id="filter-urgency-value" class="filter-value">0</span>
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="filter-button" id="apply-filters">Apply Filters</button>
                    <button class="filter-button filter-button-secondary" id="reset-filters">Reset</button>
                    <span class="filter-count" id="filter-count"></span>
                </div>
            </div>

            <div class="transaction-feed" id="transaction-feed">
                <div class="feed-empty-state" id="feed-empty">
                    <p>Waiting for whale transactions...</p>
                    <small>Transactions over 100 BTC will appear here</small>
                </div>
            </div>
        </section>

        <!-- Historical Chart Section -->
        <section class="chart-section">
            <div class="section-header">
                <h2>Net Flow History (24h)</h2>
                <div class="chart-controls">
                    <select class="timeframe-selector" id="timeframe-selector">
                        <option value="1h">1 Hour</option>
                        <option value="6h">6 Hours</option>
                        <option value="24h" selected>24 Hours</option>
                        <option value="7d">7 Days</option>
                    </select>
                </div>
            </div>

            <div class="chart-container" id="chart-container">
                <!-- Loading State -->
                <div class="chart-loading" id="chart-loading">
                    <div class="spinner"></div>
                    <p>Loading chart data...</p>
                </div>

                <!-- Plotly Chart (will be rendered here) -->
                <div id="whale-chart" class="whale-chart"></div>

                <!-- Error State -->
                <div class="chart-error hidden" id="chart-error">
                    <p class="error-message">‚ö†Ô∏è Unable to load chart</p>
                    <button class="retry-button" id="chart-retry">Retry</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Alert Configuration Panel (T084) -->
    <div class="alert-config-overlay hidden" id="alert-config-overlay">
        <div class="alert-config-panel">
            <div class="alert-config-header">
                <h3>Alert Settings</h3>
                <button class="alert-config-close" id="alert-config-close">√ó</button>
            </div>

            <div class="alert-config-body">
                <!-- Sound Notifications -->
                <div class="alert-config-section">
                    <h4>Sound Notifications</h4>
                    <div class="alert-config-row">
                        <label class="alert-toggle-label">
                            <input type="checkbox" id="alert-sound-enabled" checked />
                            <span>Enable sound alerts for critical transactions (‚â•500 BTC)</span>
                        </label>
                    </div>
                    <div class="alert-config-row">
                        <label class="alert-slider-label">
                            <span>Volume</span>
                            <input
                                type="range"
                                id="alert-sound-volume"
                                min="0"
                                max="100"
                                value="50"
                                class="alert-slider"
                            />
                            <span id="alert-volume-value" class="alert-value">50%</span>
                        </label>
                    </div>
                </div>

                <!-- Browser Notifications -->
                <div class="alert-config-section">
                    <h4>Browser Notifications</h4>
                    <div class="alert-config-row">
                        <label class="alert-toggle-label">
                            <input type="checkbox" id="alert-browser-enabled" checked />
                            <span>Enable browser notifications</span>
                        </label>
                    </div>
                    <div class="alert-config-row">
                        <button class="alert-permission-button" id="alert-request-permission">
                            Request Permission
                        </button>
                        <span id="alert-permission-status" class="alert-status">Not granted</span>
                    </div>
                    <p class="alert-help-text">
                        Browser notifications work even when this tab is inactive.
                        You must grant permission first.
                    </p>
                </div>

                <!-- Alert Thresholds -->
                <div class="alert-config-section">
                    <h4>Alert Thresholds (BTC)</h4>
                    <div class="alert-config-row">
                        <label class="alert-input-label">
                            <span>Critical (üî¥ Red)</span>
                            <input
                                type="number"
                                id="alert-threshold-critical"
                                min="100"
                                step="50"
                                value="500"
                                class="alert-input"
                            />
                            <span class="alert-unit">BTC</span>
                        </label>
                    </div>
                    <div class="alert-config-row">
                        <label class="alert-input-label">
                            <span>High (üü† Orange)</span>
                            <input
                                type="number"
                                id="alert-threshold-high"
                                min="50"
                                step="25"
                                value="200"
                                class="alert-input"
                            />
                            <span class="alert-unit">BTC</span>
                        </label>
                    </div>
                    <div class="alert-config-row">
                        <label class="alert-input-label">
                            <span>Medium (üü¢ Green)</span>
                            <input
                                type="number"
                                id="alert-threshold-medium"
                                min="10"
                                step="10"
                                value="100"
                                class="alert-input"
                            />
                            <span class="alert-unit">BTC</span>
                        </label>
                    </div>
                    <p class="alert-help-text">
                        Only transactions above these thresholds will trigger alerts.
                    </p>
                </div>

                <!-- Test Alert -->
                <div class="alert-config-section">
                    <h4>Test Alerts</h4>
                    <div class="alert-config-row alert-test-buttons">
                        <button class="alert-test-button alert-test-critical" id="alert-test-critical">
                            Test Critical
                        </button>
                        <button class="alert-test-button alert-test-high" id="alert-test-high">
                            Test High
                        </button>
                        <button class="alert-test-button alert-test-medium" id="alert-test-medium">
                            Test Medium
                        </button>
                    </div>
                    <p class="alert-help-text">
                        Click to test each alert level.
                    </p>
                </div>

                <!-- Alert History (T087) -->
                <div class="alert-config-section">
                    <div class="alert-history-header">
                        <h4>Recent Alerts (Last 10)</h4>
                        <button class="alert-history-clear" id="alert-history-clear" title="Clear history">
                            Clear
                        </button>
                    </div>
                    <div class="alert-history-list" id="alert-history-list">
                        <div class="alert-history-empty">
                            No alerts yet
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert-config-footer">
                <button class="alert-save-button" id="alert-save-settings">Save Settings</button>
                <button class="alert-cancel-button" id="alert-cancel-settings">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="footer-content">
            <p>UTXOracle Whale Detection Dashboard | Data updates every 5 seconds</p>
            <p class="footer-links">
                <a href="/api/whale/latest" target="_blank">API</a> |
                <a href="https://github.com/your-repo/UTXOracle" target="_blank">GitHub</a>
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- Plotly.js Basic Bundle (lightweight, ~800KB) -->
    <script src="https://cdn.plot.ly/plotly-basic-2.27.0.min.js" charset="utf-8"></script>
    <script type="module" src="/static/js/whale_dashboard.js"></script>
</body>
</html>
